<!doctype html>
<html>
<head>
    <title>Pi AD2</title>
    <style>
        body {
            width: 480px;
            height: 320px;
            overflow: hidden;
            background: #333333
        }
        #ui div {
            background: #dddddd;
            border: 1px solid #000000;
            border-radius: 5px;
            padding: 6px;
            margin: 4px;
            font-family: "Courier New";
            text-align: center;
            width: 203px;
            height: 88px;
            float: left;
        }
        .title {
            font-size: 24px;
            font-weight: bold;
        }
        #ui div#time {
            width: 436px;
            height: 54px;
            vertical-align: middle;
        }
        #time .info {
            width: 120px;
        }
        .info {
            font-size: 48px;
        }
        #buttons {
            float: right;
        }
        #buttons span {
            margin-right: 10px;
        }
        #buttons span.disabled {
            opacity: 0.2;
        }
        #buttons img {
            height: 48px;
            width: 48px;
        }
        span.metric {
            display: none;
        }
    </style>
</head>
<body class="imperial">
    <div id="ui">
        <div id="time">
            <span class="info"></span>
            <span id="buttons">
                <span id="play" class="start">
                    <img src="/images/play.svg" />
                </span>
                <span id="pause" class="disabled">
                    <img src="/images/pause.svg" />
                </span>
                <span id="stop" class="disabled">
                    <img src="/images/stop.svg" />
                </span>
                <span id="exit">
                    <img src="/images/close.svg" />
                </span>
            </span>
        </div>
        <div id="calories">
            <span class="title">Calories</span><br />
            <span class="info"></span>
        </div>
        <div id="distance">
            <span class="title imperial">Miles</span>
            <span class="title metric">km</span><br />
            <span class="info imperial"></span>
            <span class="info metric"></span>
        </div>
        <div id="speed">
            <span class="title imperial">MPH</span>
            <span class="title metric">km/h</span><br />
            <span class="info imperial"></span>
            <span class="info metric"></span>
        </div>
        <div id="rpms">
            <span class="title">RPM</span><br />
            <span class="info"></span>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="/jquery-3.1.1.min.js"></script>
    <script>
        var socket = io();

        jQuery('#time span.info').text('00:00');
        jQuery('#calories span.info').text(0);
        jQuery('#distance span.info').text(0);
        jQuery('#speed span.info').text(0);
        jQuery('#rpms span.info').text(0);

        jQuery('#play').on('click', function() {
            if ( ! jQuery(this).hasClass('disabled')) {
                if (jQuery('#play').hasClass('start')) {
                    socket.emit('start');

                    socket.on('data', function (data) {
                        jQuery('#time span.info').text(data['time']);
                        jQuery('#calories span.info').text(data['calories']);
                        jQuery('#distance span.info.imperial').text(data['distance']);
                        jQuery('#distance span.info.metric').text(convert_to_metric(data['distance'], 3));
                        jQuery('#speed span.info.imperial').text(data['speed']);
                        jQuery('#speed span.info.metric').text(convert_to_metric(data['speed'], 1));
                        jQuery('#rpms span.info').text(data['rpms']);
                    });

                    jQuery('#play').removeClass('start');
                }

                jQuery('#play').addClass('disabled');
                jQuery('#pause, #stop').removeClass('disabled');
            }
        });

        jQuery('#pause').on('click', function() {
            if ( ! jQuery(this).hasClass('disabled')) {
                socket.emit('pause');

                jQuery('#pause').addClass('disabled');
                jQuery('#play').removeClass('disabled');
            }
        });

        jQuery('#stop').on('click', function() {
            if ( ! jQuery(this).hasClass('disabled')) {
                socket.emit('stop');

                jQuery('#play, #pause, #stop').addClass('disabled');
            }
        });

        jQuery('#exit').on('click', function() {
            socket.emit('exit');

            jQuery('#ui').hide();
            jQuery('body').css('background-color', '#000000');
        });

        jQuery('#distance, #speed').on('click', function() {
            if ( jQuery('body').hasClass('metric')) {
                jQuery('body').removeClass('metric').addClass('imperial');
                jQuery('span.metric').hide();
                jQuery('span.imperial').show();
            } else {
                jQuery('body').removeClass('imperial').addClass('metric');
                jQuery('span.imperial').hide();
                jQuery('span.metric').show();
            }
        });

        function convert_to_metric(number, precision) {
            return (number / 0.62137).toFixed(precision);
        }
    </script>
</body>
</html>